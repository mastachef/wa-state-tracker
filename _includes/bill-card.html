{% comment %}
  Bill card partial - displays a bill in a card format
  Usage: {% include bill-card.html bill=bill featured=true %}
{% endcomment %}

<article class="bill-card {% if include.featured %}bill-card-featured{% endif %} threat-{{ include.bill.threat_level | default: 'unknown' }}">
  <header class="bill-card-header">
    <span class="bill-number">{{ include.bill.bill_number }}</span>
    <span class="status-badge status-{{ include.bill.status | slugify }}">{{ include.bill.status }}</span>
    <div class="threat-badge threat-{{ include.bill.threat_level | default: 'unknown' }}">
      {% case include.bill.threat_level %}
        {% when 'critical' %}
          Critical
        {% when 'high' %}
          High
        {% when 'moderate' %}
          Moderate
        {% when 'low' %}
          Low
        {% when 'beneficial' %}
          Good
        {% else %}
          ?
      {% endcase %}
    </div>
  </header>

  <h3 class="bill-card-title">
    {% assign bill_slug = include.bill.bill_number | slugify %}
    <a href="{{ '/bill/' | append: bill_slug | append: '/' | relative_url }}">
      {{ include.bill.title | truncate: 100 }}
    </a>
  </h3>

  {% if include.bill.plain_summary %}
  <p class="bill-card-summary">{{ include.bill.plain_summary | strip_html | truncate: 150 }}</p>
  {% elsif include.bill.description %}
  <p class="bill-card-summary">{{ include.bill.description | strip_html | truncate: 150 }}</p>
  {% endif %}

  {% if include.featured and include.bill.why_featured %}
  <p class="bill-card-featured-reason">
    <strong>Why watch:</strong> {{ include.bill.why_featured }}
  </p>
  {% endif %}

  {% if include.bill.urgency == "high" %}
  <div class="bill-card-urgency">
    <span class="urgency-badge urgency-high">Action Needed</span>
    {% if include.bill.hearing_date %}
    <span class="hearing-date">Hearing: {{ include.bill.hearing_date }}</span>
    {% endif %}
  </div>
  {% endif %}

  <footer class="bill-card-footer">
    <div class="bill-card-meta">
      {% if include.bill.sponsors and include.bill.sponsors.size > 0 %}
      <span class="sponsor">{{ include.bill.sponsors | first }}</span>
      {% endif %}
      {% if include.bill.last_action_date %}
      <span class="last-action">{{ include.bill.last_action_date }}</span>
      {% endif %}
    </div>
    <div class="bill-card-actions">
      <a href="{{ '/bill/' | append: bill_slug | append: '/' | relative_url }}" class="btn btn-small">View Details</a>
      <a href="https://app.leg.wa.gov/pbc/bill/{{ include.bill.bill_number | remove: 'HB ' | remove: 'SB ' | remove: 'HJR ' | remove: 'SJR ' }}"
         class="btn btn-small btn-primary"
         target="_blank"
         rel="noopener">Comment</a>
    </div>
  </footer>
</article>
