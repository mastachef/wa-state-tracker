---
layout: default
title: Analytics
description: Visual breakdown of Washington State legislation by threat level, chamber, and status.
permalink: /analytics/
---

<section class="page-header">
  <h1>Bill Analytics</h1>
  <p>Visual breakdown of {{ site.data.bills.size }} bills in the {{ site.current_session }} session.</p>
</section>

{% comment %} Calculate all stats upfront {% endcomment %}
{% assign critical = site.data.bills | where: "threat_level", "critical" | size %}
{% assign high = site.data.bills | where: "threat_level", "high" | size %}
{% assign moderate = site.data.bills | where: "threat_level", "moderate" | size %}
{% assign low = site.data.bills | where: "threat_level", "low" | size %}
{% assign beneficial = site.data.bills | where: "threat_level", "beneficial" | size %}
{% assign total = site.data.bills.size %}

{% assign house = site.data.bills | where: "chamber", "House" | size %}
{% assign senate = site.data.bills | where: "chamber", "Senate" | size %}

{% assign introduced = site.data.bills | where: "status", "Introduced" | size %}
{% assign prefiled = site.data.bills | where: "status", "Prefiled" | size %}
{% assign in_committee = site.data.bills | where: "status", "In Committee" | size %}
{% assign passed_house = site.data.bills | where: "status", "Passed House" | size %}
{% assign passed_senate = site.data.bills | where: "status", "Passed Senate" | size %}
{% assign passed = site.data.bills | where: "status", "Passed" | size %}
{% assign enrolled = site.data.bills | where: "status", "Enrolled" | size %}
{% assign signed = site.data.bills | where: "status", "Signed" | size %}
{% assign vetoed = site.data.bills | where: "status", "Vetoed" | size %}
{% assign failed = site.data.bills | where: "status", "Failed" | size %}

{% assign house_bills = site.data.bills | where: "chamber", "House" %}
{% assign senate_bills = site.data.bills | where: "chamber", "Senate" %}
{% assign house_critical = house_bills | where: "threat_level", "critical" | size %}
{% assign house_high = house_bills | where: "threat_level", "high" | size %}
{% assign house_moderate = house_bills | where: "threat_level", "moderate" | size %}
{% assign house_low = house_bills | where: "threat_level", "low" | size %}
{% assign house_beneficial = house_bills | where: "threat_level", "beneficial" | size %}
{% assign senate_critical = senate_bills | where: "threat_level", "critical" | size %}
{% assign senate_high = senate_bills | where: "threat_level", "high" | size %}
{% assign senate_moderate = senate_bills | where: "threat_level", "moderate" | size %}
{% assign senate_low = senate_bills | where: "threat_level", "low" | size %}
{% assign senate_beneficial = senate_bills | where: "threat_level", "beneficial" | size %}

<!-- Summary Stats Row -->
<section class="summary-stats">
  <div class="summary-stat summary-total">
    <span class="summary-number">{{ total }}</span>
    <span class="summary-label">Total Bills</span>
  </div>
  <div class="summary-stat summary-danger">
    <span class="summary-number">{{ critical | plus: high }}</span>
    <span class="summary-label">High Priority Threats</span>
  </div>
  <div class="summary-stat summary-warning">
    <span class="summary-number">{{ moderate }}</span>
    <span class="summary-label">Moderate Concern</span>
  </div>
  <div class="summary-stat summary-success">
    <span class="summary-number">{{ low | plus: beneficial }}</span>
    <span class="summary-label">Positive Bills</span>
  </div>
</section>

<!-- Charts Section -->
<section class="charts-section">
  <div class="charts-grid">
    <!-- Threat Level Pie Chart -->
    <div class="chart-card">
      <h2>Threat Level Distribution</h2>
      <div class="chart-wrapper">
        <canvas id="threatChart"></canvas>
      </div>
    </div>

    <!-- Chamber Doughnut Chart -->
    <div class="chart-card">
      <h2>Bills by Chamber</h2>
      <div class="chart-wrapper">
        <canvas id="chamberChart"></canvas>
      </div>
    </div>

    <!-- Status Bar Chart -->
    <div class="chart-card chart-card-wide">
      <h2>Legislative Pipeline</h2>
      <div class="chart-wrapper chart-wrapper-bar">
        <canvas id="statusChart"></canvas>
      </div>
    </div>

    <!-- Threat by Chamber Stacked Bar -->
    <div class="chart-card chart-card-wide">
      <h2>Threat Levels by Chamber</h2>
      <div class="chart-wrapper chart-wrapper-bar">
        <canvas id="chamberThreatChart"></canvas>
      </div>
    </div>
  </div>
</section>

<!-- Recent Activity -->
<section class="analytics-section">
  <h2>Recent Activity</h2>
  <p class="section-desc">Bills with the most recent action dates.</p>

  {% assign recent_bills = site.data.bills | sort: "last_action_date" | reverse %}
  <div class="recent-activity">
    {% for bill in recent_bills limit: 10 %}
    <div class="activity-row">
      <span class="activity-date">{{ bill.last_action_date }}</span>
      <span class="activity-bill">{{ bill.bill_number }}</span>
      <span class="activity-title">{{ bill.title | truncate: 60 }}</span>
      <span class="activity-threat threat-badge threat-{{ bill.threat_level | default: 'unknown' }}">
        {% case bill.threat_level %}
          {% when 'critical' %}Critical
          {% when 'high' %}High
          {% when 'moderate' %}Moderate
          {% when 'low' %}Low
          {% when 'beneficial' %}Good
          {% else %}?
        {% endcase %}
      </span>
    </div>
    {% endfor %}
  </div>
  <div class="section-footer">
    <a href="{{ '/all-bills/' | relative_url }}" class="btn btn-secondary">View All Bills</a>
  </div>
</section>

<!-- Critical Bills Section -->
<section class="analytics-section">
  <h2>Critical Threat Bills</h2>
  <p class="section-desc">These {{ critical }} bills pose the highest threat and need immediate attention.</p>

  {% assign critical_bills = site.data.bills | where: "threat_level", "critical" %}
  {% if critical_bills.size > 0 %}
  <div class="bills-grid">
    {% for bill in critical_bills limit: 6 %}
      {% include bill-card.html bill=bill %}
    {% endfor %}
  </div>
  {% if critical_bills.size > 6 %}
  <div class="section-footer">
    <a href="{{ '/all-bills/?threat=critical' | relative_url }}" class="btn btn-secondary">View All {{ critical }} Critical Bills</a>
  </div>
  {% endif %}
  {% else %}
  <p class="empty-state">No critical threat bills found.</p>
  {% endif %}
</section>

<!-- Beneficial Bills Section -->
<section class="analytics-section">
  <h2>Beneficial Bills</h2>
  <p class="section-desc">Bills that could reduce government power or expand liberty.</p>

  {% assign good_bills = site.data.bills | where: "threat_level", "beneficial" %}
  {% assign low_bills = site.data.bills | where: "threat_level", "low" %}
  {% if good_bills.size > 0 or low_bills.size > 0 %}
  <div class="bills-grid">
    {% for bill in good_bills limit: 3 %}
      {% include bill-card.html bill=bill %}
    {% endfor %}
    {% for bill in low_bills limit: 3 %}
      {% include bill-card.html bill=bill %}
    {% endfor %}
  </div>
  <div class="section-footer">
    <a href="{{ '/all-bills/?threat=beneficial' | relative_url }}" class="btn btn-secondary">View All Beneficial Bills</a>
    <a href="{{ '/all-bills/?threat=low' | relative_url }}" class="btn btn-secondary">View All Low Threat Bills</a>
  </div>
  {% else %}
  <p class="empty-state">No beneficial bills found yet.</p>
  {% endif %}
</section>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script>
// Chart data from Jekyll
const chartData = {
  threat: {
    critical: {{ critical }},
    high: {{ high }},
    moderate: {{ moderate }},
    low: {{ low }},
    beneficial: {{ beneficial }}
  },
  chamber: {
    house: {{ house }},
    senate: {{ senate }}
  },
  status: {
    introduced: {{ introduced | plus: prefiled }},
    inCommittee: {{ in_committee }},
    passedChamber: {{ passed_house | plus: passed_senate }},
    passedBoth: {{ passed | plus: enrolled }},
    signed: {{ signed }},
    vetoed: {{ vetoed }},
    failed: {{ failed }}
  },
  chamberThreat: {
    house: {
      critical: {{ house_critical }},
      high: {{ house_high }},
      moderate: {{ house_moderate }},
      low: {{ house_low }},
      beneficial: {{ house_beneficial }}
    },
    senate: {
      critical: {{ senate_critical }},
      high: {{ senate_high }},
      moderate: {{ senate_moderate }},
      low: {{ senate_low }},
      beneficial: {{ senate_beneficial }}
    }
  }
};

// Color schemes
const threatColors = {
  critical: '#dc2626',
  high: '#ea580c',
  moderate: '#ca8a04',
  low: '#16a34a',
  beneficial: '#059669'
};

const chamberColors = {
  house: '#3b82f6',
  senate: '#8b5cf6'
};

const statusColors = ['#64748b', '#3b82f6', '#8b5cf6', '#f59e0b', '#22c55e', '#ef4444', '#6b7280'];

// Chart defaults for dark theme
Chart.defaults.color = '#94a3b8';
Chart.defaults.borderColor = '#1e4470';

// Threat Level Pie Chart
new Chart(document.getElementById('threatChart'), {
  type: 'doughnut',
  data: {
    labels: ['Critical', 'High', 'Moderate', 'Low', 'Beneficial'],
    datasets: [{
      data: [
        chartData.threat.critical,
        chartData.threat.high,
        chartData.threat.moderate,
        chartData.threat.low,
        chartData.threat.beneficial
      ],
      backgroundColor: [
        threatColors.critical,
        threatColors.high,
        threatColors.moderate,
        threatColors.low,
        threatColors.beneficial
      ],
      borderWidth: 0
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: 'bottom',
        labels: {
          padding: 20,
          usePointStyle: true
        }
      }
    }
  }
});

// Chamber Doughnut Chart
new Chart(document.getElementById('chamberChart'), {
  type: 'doughnut',
  data: {
    labels: ['House', 'Senate'],
    datasets: [{
      data: [chartData.chamber.house, chartData.chamber.senate],
      backgroundColor: [chamberColors.house, chamberColors.senate],
      borderWidth: 0
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: 'bottom',
        labels: {
          padding: 20,
          usePointStyle: true
        }
      }
    }
  }
});

// Status Bar Chart (Legislative Pipeline)
new Chart(document.getElementById('statusChart'), {
  type: 'bar',
  data: {
    labels: ['Introduced', 'In Committee', 'Passed Chamber', 'Passed Both', 'Signed', 'Vetoed', 'Failed'],
    datasets: [{
      label: 'Bills',
      data: [
        chartData.status.introduced,
        chartData.status.inCommittee,
        chartData.status.passedChamber,
        chartData.status.passedBoth,
        chartData.status.signed,
        chartData.status.vetoed,
        chartData.status.failed
      ],
      backgroundColor: statusColors,
      borderRadius: 4
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    indexAxis: 'y',
    plugins: {
      legend: {
        display: false
      }
    },
    scales: {
      x: {
        grid: {
          color: '#1e4470'
        }
      },
      y: {
        grid: {
          display: false
        }
      }
    }
  }
});

// Chamber Threat Comparison (Grouped Bar)
new Chart(document.getElementById('chamberThreatChart'), {
  type: 'bar',
  data: {
    labels: ['Critical', 'High', 'Moderate', 'Low', 'Beneficial'],
    datasets: [
      {
        label: 'House',
        data: [
          chartData.chamberThreat.house.critical,
          chartData.chamberThreat.house.high,
          chartData.chamberThreat.house.moderate,
          chartData.chamberThreat.house.low,
          chartData.chamberThreat.house.beneficial
        ],
        backgroundColor: chamberColors.house,
        borderRadius: 4
      },
      {
        label: 'Senate',
        data: [
          chartData.chamberThreat.senate.critical,
          chartData.chamberThreat.senate.high,
          chartData.chamberThreat.senate.moderate,
          chartData.chamberThreat.senate.low,
          chartData.chamberThreat.senate.beneficial
        ],
        backgroundColor: chamberColors.senate,
        borderRadius: 4
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: 'bottom',
        labels: {
          padding: 20,
          usePointStyle: true
        }
      }
    },
    scales: {
      x: {
        grid: {
          display: false
        }
      },
      y: {
        grid: {
          color: '#1e4470'
        }
      }
    }
  }
});
</script>

<style>
/* Summary Stats */
.summary-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-4);
  margin-bottom: var(--space-8);
}

.summary-stat {
  background: var(--color-bg-medium);
  border-radius: var(--radius-lg);
  padding: var(--space-6);
  text-align: center;
  border: 1px solid var(--color-border);
}

.summary-number {
  display: block;
  font-size: 3rem;
  font-weight: 700;
  line-height: 1;
  margin-bottom: var(--space-2);
}

.summary-label {
  font-size: 0.875rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.summary-total .summary-number { color: var(--color-primary-light); }
.summary-danger .summary-number { color: #ef4444; }
.summary-warning .summary-number { color: #f59e0b; }
.summary-success .summary-number { color: #22c55e; }

/* Charts Section */
.charts-section {
  margin-bottom: var(--space-12);
}

.charts-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-6);
}

.chart-card {
  background: var(--color-bg-medium);
  border-radius: var(--radius-lg);
  padding: var(--space-6);
  border: 1px solid var(--color-border);
}

.chart-card h2 {
  font-size: 1.125rem;
  margin-bottom: var(--space-4);
  padding-bottom: var(--space-2);
  border-bottom: 1px solid var(--color-border);
}

.chart-card-wide {
  grid-column: span 2;
}

.chart-wrapper {
  height: 300px;
  position: relative;
}

.chart-wrapper-bar {
  height: 250px;
}

/* Recent Activity */
.recent-activity {
  background: var(--color-bg-medium);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-border);
  overflow: hidden;
}

.activity-row {
  display: grid;
  grid-template-columns: 100px 80px 1fr auto;
  gap: var(--space-3);
  padding: var(--space-3) var(--space-4);
  border-bottom: 1px solid var(--color-border);
  align-items: center;
}

.activity-row:last-child {
  border-bottom: none;
}

.activity-date {
  font-size: 0.75rem;
  color: var(--color-text-dim);
  font-family: var(--font-mono);
}

.activity-bill {
  font-weight: 600;
  font-size: 0.875rem;
  color: var(--color-primary-light);
}

.activity-title {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.activity-threat {
  font-size: 0.625rem;
  padding: var(--space-1) var(--space-2);
}

/* Analytics Sections */
.analytics-section {
  margin-bottom: var(--space-12);
}

.analytics-section h2 {
  margin-bottom: var(--space-2);
}

.section-desc {
  color: var(--color-text-muted);
  margin-bottom: var(--space-6);
}

.section-footer {
  text-align: center;
  margin-top: var(--space-6);
  display: flex;
  gap: var(--space-3);
  justify-content: center;
  flex-wrap: wrap;
}

/* Responsive */
@media (max-width: 768px) {
  .charts-grid {
    grid-template-columns: 1fr;
  }

  .chart-card-wide {
    grid-column: span 1;
  }

  .activity-row {
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
  }

  .activity-title {
    grid-column: 1 / -1;
  }

  .summary-number {
    font-size: 2rem;
  }
}
</style>
